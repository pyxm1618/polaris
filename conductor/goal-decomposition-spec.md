# 目标拆解模块需求规格书 v1.0

> 最后更新：2025-12-26
> 状态：需求讨论完成，待开发

## 一、模块定位

### 核心任务
将用户的年度愿景（北极星）拆解为可排期到每日的任务列表。

### AI的角色
**引导者、建议者、补全者**。用户始终是决策者。

### 设计原则
- 用户为主，AI辅助
- 从交付物反推任务
- 任务粒度可配置
- 随时可保存草稿

---

## 二、数据层级结构

```
L1: 北极星 (NorthStar)
    └── 年度愿景，每用户1个
    └── 字段：id, user_id, title, year, created_at

L2: 目标 (Goal)
    └── 可量化的阶段性目标，2-5个
    └── 字段：id, user_id, northstar_id, title, target_date, status

L3: 项目 (Project) 【长期资产，可复用】
    └── 可关联多个目标
    └── 字段：id, user_id, name, primary_domain, status, created_at
    └── 估时：自动汇总（所有任务估时之和）

L4: 任务 (Task)
    └── 原子执行单元，扁平结构，无子任务
    └── 字段：id, project_id, name, domain(可覆盖), estimated_hours, 
              sequence(隐式依赖), status, scheduled_date
```

### 关联关系
- 北极星 1:N 目标
- 目标 N:M 项目（一个项目可服务多个目标）
- 项目 1:N 任务

### 关联方式
- 在项目详情里关联目标（项目为主体）
- 项目复用：智能推荐 + 搜索选择

---

## 三、域（Domain）设计

### 归属规则
项目有主域，任务默认继承，可手动覆盖。

### 预设域
- 产品设计
- 技术研发
- 测试
- 运营推广
- 学习知识
- 数据分析
- 休闲娱乐

### 自定义域
用户可创建自定义域（名称 + 描述）。

---

## 四、用户基线参数

| 参数 | 收集时机 | 说明 |
|------|---------|------|
| 排期精度偏好 | 初始引导 + 设置页 | 周计划/日计划/时段计划 |
| 每周可用时间 | 初始引导 + 设置页 | 总小时数，或每天详细配置 |
| 最大并行项目数 | 初始引导 + 设置页 | 同时进行的项目数量限制 |

### 排期精度与任务粒度

| 精度选项 | 说明 | 建议任务估时 |
|---------|------|-------------|
| 周计划 | 只需知道每周做什么 | 20-40h |
| 日计划 | 精确到每天做什么 | 4-16h |
| 时段计划 | 规划上午/下午 | 2-4h |

---

## 五、交互流程设计

### 阶段一：战略定向（~5分钟）

| 步骤 | 用户行为 | AI行为 |
|------|---------|--------|
| 1.1 北极星输入 | 输入年度愿景（自然语言）| - |
| 1.2 AI澄清 | 回答AI问题（可选）| 如果愿景模糊，提1-2个澄清问题 |
| 1.3 目标设定 | 输入/选择2-5个季度目标 | 建议可能的目标方向 |
| 1.4 时间锚点 | 为每个目标设定目标日期 | 检查时间分布合理性 |

**产出**：北极星 + 2-5个带时间锚点的目标

---

### 阶段二：项目映射（~5分钟）

| 步骤 | 用户行为 | AI行为 |
|------|---------|--------|
| 2.1 项目关联 | 为每个目标选择/创建支撑项目 | 提示孤立目标 |
| 2.2 项目设置 | 设置项目名称、主域 | 智能推荐匹配的已有项目 |

**产出**：项目列表，每个项目关联到目标

---

### 阶段三：任务拆解（~15-20分钟）

#### 界面形态
混合式：结构化任务编辑器 + AI侧边助手

#### 引导起点
从交付物开始

| 步骤 | 用户行为 | AI行为 |
|------|---------|--------|
| 3.1 交付物识别 | 选择/描述项目的最终交付物 | 提供常见交付物类型选项 |
| 3.2 功能/模块拆解 | 列出主要功能/组成部分 | 建议常见功能模块 |
| 3.3 任务生成 | 审核/编辑AI生成的任务列表 | 生成任务草稿（含名称、估时）|
| 3.4 任务调整 | 增删改任务，调整估时 | 侧边栏随时可问 |
| 3.5 依赖排序 | 调整任务顺序（隐式依赖）| 智能推断合理顺序 |

#### 任务分组显示
任务按功能模块分组显示，但数据上保持扁平。

#### 依赖关系
隐式依赖（按顺序排列），暂不显式展示连接线。

#### 流程节奏
连续拆解多个项目，最后统一确认。

**产出**：每个项目下的任务列表（含估时、域、顺序）

---

### 阶段四：现实校验（~5分钟）

| 步骤 | 用户行为 | AI行为 |
|------|---------|--------|
| 4.1 资源确认 | 确认/调整每周可用时间 | - |
| 4.2 可行性推演 | 查看推演结果 | 计算总工作量 vs 可用时间 |
| 4.3 调整决策 | 如有冲突，决定调整方案 | 建议几种调整方案 |

**产出**：通过可行性检验的完整目标体系

---

### 阶段五：最终确认

| 步骤 | 用户行为 | 系统行为 |
|------|---------|---------|
| 5.1 总览确认 | 查看完整的目标→项目→任务树 | 展示全貌 |
| 5.2 保存 | 点击确认 | 持久化到数据库 |

---

## 六、草稿保存机制

- 每完成一个步骤，自动保存草稿状态
- 用户可以随时退出，下次进入继续
- 草稿状态不影响正式数据，只有最终确认才生效

---

## 七、AI能力边界

| 功能 | 实现方式 | 调用场景 |
|------|---------|---------|
| 北极星澄清问题 | 大模型 (Prompt) | 用户输入模糊时 |
| 目标方向建议 | 大模型 (Prompt) | 阶段一 |
| 交付物→任务生成 | 大模型 (Prompt) | 阶段三核心 |
| 任务估时建议 | 大模型 | 阶段三 |
| 依赖顺序推断 | 大模型（简单推理） | 阶段三 |
| 时间分布检查 | 规则引擎 | 阶段一、四 |
| 可行性推演 | 规则引擎（算术） | 阶段四 |
| 冲突调整建议 | 大模型 | 阶段四 |

---

## 八、暂不实现（后续迭代）

- [ ] 子任务
- [ ] 显式依赖关系图
- [ ] 估时修正机制（记录实际耗时，AI参考）
- [ ] 历史速度校准
- [ ] 精力周期配置（高效/低效时段）

---

## 九、与现有代码的差异

### 当前实现的问题
1. Wizard只有3步：北极星 → 里程碑 → 域选择
2. 没有任务拆解
3. 没有AI辅助
4. 没有现实基线收集
5. 没有可行性校验

### 需要重构的部分
1. 完全重新设计Wizard流程
2. 新增数据表：goals, goal_project_relations
3. 修改project表：增加primary_domain字段
4. 新增AI接口：目标建议、任务生成、估时建议等
5. 新增草稿保存机制
